import{r as c,l as de,B as ue,o as pe,a as v,z as ce,w as xe,h as o,b as e,c as l,i as m,s as h,F as g,g as b,t as r,U as k,p as me,j as Q,y as X}from"./index-Cv3Gfbck.js";import{_ as ge}from"./AdminLayout-DzmIWmFz.js";const be={class:"p-6 lg:p-8"},ye={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6"},fe={class:"flex space-x-3"},ve=["disabled"],he={key:0,class:"w-5 h-5 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},ke={key:1,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},we=["disabled"],_e={key:0,class:"w-5 h-5 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},je={key:1,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ke={class:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6"},Ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4"},Be=["value"],Te=["value"],Se=["value"],De=["value"],Ie={key:0,class:"flex justify-center py-20"},Me={key:1,class:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"},Ve={class:"overflow-x-auto"},Fe={class:"w-full min-w-[1400px]"},Ee={class:"divide-y divide-gray-100"},Pe={class:"px-4 py-4"},Le={class:"flex items-center"},Ue={class:"w-9 h-9 bg-gradient-to-br from-bpjs-400 to-bpjs-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0"},ze={class:"text-white font-bold text-sm"},Ae={class:"min-w-0"},Oe={class:"font-medium text-gray-900 truncate"},Re={class:"text-xs text-gray-500 font-mono"},He={class:"px-4 py-4"},Ne=["title"],$e={key:1,class:"text-gray-400 text-sm"},Je={class:"px-4 py-4"},Ge=["title"],Ye={key:1,class:"text-gray-400 text-sm"},We={class:"px-4 py-4"},qe=["title"],Qe={key:1,class:"text-gray-400 text-sm"},Xe={class:"px-4 py-4"},Ze=["title"],et={key:1,class:"text-gray-400 text-sm"},tt={class:"px-4 py-4"},st={class:"text-sm text-gray-900"},at={class:"text-xs text-gray-500"},ot={class:"px-4 py-4"},lt={class:"text-sm text-gray-900 font-medium"},rt={class:"px-4 py-4 text-center"},nt={key:0,class:"inline-flex items-center px-2 py-1 rounded-lg bg-violet-100 text-violet-700 text-xs font-medium"},it={key:1,class:"inline-flex items-center px-2 py-1 rounded-lg bg-gray-100 text-gray-500 text-xs font-medium"},dt={class:"px-4 py-4 text-center"},ut={class:"px-4 py-4 text-center"},pt={class:"text-sm text-gray-600"},ct={class:"px-4 py-4"},xt={class:"text-sm text-gray-900"},mt={class:"text-xs text-gray-500"},gt={key:0,class:"text-center py-16"},bt={key:1,class:"flex items-center justify-between px-6 py-4 border-t border-gray-100 bg-gray-50"},yt={class:"text-sm text-gray-500"},ft={class:"font-medium"},vt={class:"font-medium"},ht={class:"flex space-x-1"},kt=["onClick"],Kt={__name:"ReportsPage",setup(wt){const y=c([]),f=c([]),w=c(!0),d=c({page:1,total:0,totalPages:0}),Z=new Date().getFullYear(),ee=Array.from({length:8},(a,s)=>Z+2-s),te=[{value:1,label:"Januari"},{value:2,label:"Februari"},{value:3,label:"Maret"},{value:4,label:"April"},{value:5,label:"Mei"},{value:6,label:"Juni"},{value:7,label:"Juli"},{value:8,label:"Agustus"},{value:9,label:"September"},{value:10,label:"Oktober"},{value:11,label:"November"},{value:12,label:"Desember"}],i=c({kategoriId:"",subKategoriId:"",periodeBulan:"",periodeTahun:""}),u=c(!1),x=c(""),se=de(()=>{var s;if(!i.value.kategoriId)return f.value.flatMap(t=>t.subKategoris.map(n=>({...n,kategoriNama:t.nama})));const a=f.value.find(t=>t.id===parseInt(i.value.kategoriId));return((s=a==null?void 0:a.subKategoris)==null?void 0:s.map(t=>({...t,kategoriNama:a.nama})))||[]});ue(()=>i.value.kategoriId,()=>{i.value.subKategoriId=""}),pe(async()=>{await Promise.all([ae(),_()])});async function ae(){const a=await v.get("/kategori");f.value=a.data}async function _(){w.value=!0;try{const a={page:d.value.page,...i.value};Object.keys(a).forEach(t=>!a[t]&&delete a[t]);const s=await v.get("/admin/results",{params:a});y.value=s.data.data,d.value=s.data.pagination}catch(a){console.error(a)}finally{w.value=!1}}function j(){d.value.page=1,_()}function oe(){i.value={kategoriId:"",subKategoriId:"",periodeBulan:"",periodeTahun:""},j()}async function le(){u.value=!0,x.value="excel";try{const a={...i.value};Object.keys(a).forEach(p=>!a[p]&&delete a[p]);const s=await v.get("/report/export/excel",{params:a,responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=t,n.setAttribute("download",`hasil-test-${Date.now()}.xlsx`),document.body.appendChild(n),n.click(),n.remove()}catch{alert("Gagal export Excel")}finally{u.value=!1,x.value=""}}async function re(){u.value=!0,x.value="pdf";try{const a={...i.value};Object.keys(a).forEach(p=>!a[p]&&delete a[p]);const s=await v.get("/report/export/pdf",{params:a,responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=t,n.setAttribute("download",`hasil-test-${Date.now()}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch{alert("Gagal export PDF")}finally{u.value=!1,x.value=""}}function ne(a){return a>=80?"text-emerald-600":a>=60?"text-amber-600":"text-red-600"}function ie(a){return a>=80?"bg-emerald-50":a>=60?"bg-amber-50":"bg-red-50"}return(a,s)=>(o(),ce(ge,null,{default:xe(()=>[e("div",be,[e("div",ye,[s[10]||(s[10]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Laporan Hasil Test"),e("p",{class:"text-gray-500 text-sm mt-1"},"Lihat dan export hasil test pengguna")],-1)),e("div",fe,[e("button",{onClick:le,disabled:u.value,class:"inline-flex items-center px-4 py-2.5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-xl font-medium shadow-lg shadow-emerald-500/30 hover:shadow-xl disabled:opacity-50 transition-all"},[u.value&&x.value==="excel"?(o(),l("svg",he,[...s[4]||(s[4]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),l("svg",ke,[...s[5]||(s[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])),s[6]||(s[6]=m(" Export Excel ",-1))],8,ve),e("button",{onClick:re,disabled:u.value,class:"inline-flex items-center px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-medium shadow-lg shadow-red-500/30 hover:shadow-xl disabled:opacity-50 transition-all"},[u.value&&x.value==="pdf"?(o(),l("svg",_e,[...s[7]||(s[7]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),l("svg",je,[...s[8]||(s[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])),s[9]||(s[9]=m(" Export PDF ",-1))],8,we)])]),e("div",Ke,[e("div",{class:"flex items-center justify-between mb-4"},[s[11]||(s[11]=e("h3",{class:"font-semibold text-gray-900"},"Filter Data",-1)),e("button",{onClick:oe,class:"text-sm text-gray-500 hover:text-gray-700"}," Reset Filter ")]),e("div",Ce,[e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},"Kategori",-1)),h(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>i.value.kategoriId=t),class:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-bpjs-500/20 focus:border-bpjs-500 transition-all bg-white"},[s[12]||(s[12]=e("option",{value:""},"Semua Kategori",-1)),(o(!0),l(g,null,b(f.value,t=>(o(),l("option",{key:t.id,value:t.id},r(t.nama),9,Be))),128))],512),[[k,i.value.kategoriId]])]),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},"Sub Kategori",-1)),h(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>i.value.subKategoriId=t),class:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-bpjs-500/20 focus:border-bpjs-500 transition-all bg-white"},[s[14]||(s[14]=e("option",{value:""},"Semua Sub Kategori",-1)),(o(!0),l(g,null,b(se.value,t=>(o(),l("option",{key:t.id,value:t.id},r(t.nama),9,Te))),128))],512),[[k,i.value.subKategoriId]])]),e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},"Periode Bulan",-1)),h(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>i.value.periodeBulan=t),class:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-bpjs-500/20 focus:border-bpjs-500 transition-all bg-white"},[s[16]||(s[16]=e("option",{value:""},"Semua Bulan",-1)),(o(),l(g,null,b(te,t=>e("option",{key:t.value,value:t.value},r(t.label),9,Se)),64))],512),[[k,i.value.periodeBulan]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},"Periode Tahun",-1)),h(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>i.value.periodeTahun=t),class:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-bpjs-500/20 focus:border-bpjs-500 transition-all bg-white"},[s[18]||(s[18]=e("option",{value:""},"Semua Tahun",-1)),(o(!0),l(g,null,b(me(ee),t=>(o(),l("option",{key:t,value:t},r(t),9,De))),128))],512),[[k,i.value.periodeTahun]])]),e("div",{class:"lg:col-span-2 flex items-end"},[e("button",{onClick:j,class:"w-full px-4 py-2.5 bg-gradient-to-r from-bpjs-500 to-bpjs-600 text-white rounded-xl font-medium shadow-lg shadow-bpjs-500/30 hover:shadow-xl transition-all"}," Terapkan Filter ")])])]),w.value?(o(),l("div",Ie,[...s[20]||(s[20]=[e("div",{class:"flex flex-col items-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-bpjs-500 mb-4"}),e("p",{class:"text-gray-500"},"Memuat data...")],-1)])])):(o(),l("div",Me,[e("div",Ve,[e("table",Fe,[s[22]||(s[22]=e("thead",null,[e("tr",{class:"bg-gray-50 border-b border-gray-100"},[e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"User"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Vendor"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Kepwil"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"KC"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Kakab"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Sub Kategori"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Modul"),e("th",{class:"px-4 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Materi"),e("th",{class:"px-4 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Skor"),e("th",{class:"px-4 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Benar"),e("th",{class:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"},"Waktu")])],-1)),e("tbody",Ee,[(o(!0),l(g,null,b(y.value,t=>{var n,p,K,C,B,T,S,D,I,M,V,F,E,P,L,U,z,A,O,R,H,N,$,J,G,Y,W,q;return o(),l("tr",{key:t.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Pe,[e("div",Le,[e("div",Ue,[e("span",ze,r((p=(n=t.user)==null?void 0:n.nama)==null?void 0:p.charAt(0)),1)]),e("div",Ae,[e("p",Oe,r((K=t.user)==null?void 0:K.nama),1),e("p",Re,r((C=t.user)==null?void 0:C.npp),1)])])]),e("td",He,[(B=t.user)!=null&&B.vendor?(o(),l("span",{key:0,class:"inline-flex items-center px-2 py-1 rounded-lg bg-purple-50 text-purple-700 text-xs font-medium max-w-[100px] truncate",title:(T=t.user)==null?void 0:T.vendor},r((S=t.user)==null?void 0:S.vendor),9,Ne)):(o(),l("span",$e,"-"))]),e("td",Je,[(D=t.user)!=null&&D.kepwil?(o(),l("span",{key:0,class:"inline-flex items-center px-2 py-1 rounded-lg bg-emerald-50 text-emerald-700 text-xs font-medium max-w-[110px] truncate",title:(I=t.user)==null?void 0:I.kepwil},r((M=t.user)==null?void 0:M.kepwil),9,Ge)):(o(),l("span",Ye,"-"))]),e("td",We,[(V=t.user)!=null&&V.kcKabupaten?(o(),l("span",{key:0,class:"inline-flex items-center px-2 py-1 rounded-lg bg-blue-50 text-blue-700 text-xs font-medium max-w-[110px] truncate",title:(F=t.user)==null?void 0:F.kcKabupaten},r((E=t.user)==null?void 0:E.kcKabupaten),9,qe)):(o(),l("span",Qe,"-"))]),e("td",Xe,[(P=t.user)!=null&&P.kakabKabupaten?(o(),l("span",{key:0,class:"inline-flex items-center px-2 py-1 rounded-lg bg-amber-50 text-amber-700 text-xs font-medium max-w-[110px] truncate",title:(L=t.user)==null?void 0:L.kakabKabupaten},r((U=t.user)==null?void 0:U.kakabKabupaten),9,Ze)):(o(),l("span",et,"-"))]),e("td",tt,[e("p",st,r((A=(z=t.modul)==null?void 0:z.subKategori)==null?void 0:A.nama),1),e("p",at,r((H=(R=(O=t.modul)==null?void 0:O.subKategori)==null?void 0:R.kategori)==null?void 0:H.nama),1)]),e("td",ot,[e("p",lt,r((N=t.modul)==null?void 0:N.nama),1)]),e("td",rt,[($=t.materiProgress)!=null&&$.isCompleted?(o(),l("span",nt,[...s[21]||(s[21]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),m(" Selesai ",-1)])])):(o(),l("span",it," Belum "))]),e("td",dt,[e("span",{class:X(["inline-flex items-center px-2.5 py-1 rounded-xl text-sm font-bold",[ie(((J=t.hasilTest)==null?void 0:J.skor)||0),ne(((G=t.hasilTest)==null?void 0:G.skor)||0)]])},r((((Y=t.hasilTest)==null?void 0:Y.skor)||0).toFixed(1))+"% ",3)]),e("td",ut,[e("span",pt,r(((W=t.hasilTest)==null?void 0:W.benar)||0)+"/"+r(((q=t.hasilTest)==null?void 0:q.totalSoal)||0),1)]),e("td",ct,[e("p",xt,r(new Date(t.endTime).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})),1),e("p",mt,r(new Date(t.endTime).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})),1)])])}),128))])])]),y.value.length===0?(o(),l("div",gt,[...s[23]||(s[23]=[e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("p",{class:"text-gray-500 font-medium"},"Tidak ada data hasil test",-1),e("p",{class:"text-sm text-gray-400 mt-1"},"Data akan muncul setelah pengguna mengerjakan test",-1)])])):Q("",!0),d.value.totalPages>1?(o(),l("div",bt,[e("p",yt,[s[24]||(s[24]=m(" Menampilkan ",-1)),e("span",ft,r(y.value.length),1),s[25]||(s[25]=m(" dari ",-1)),e("span",vt,r(d.value.total),1),s[26]||(s[26]=m(" hasil ",-1))]),e("div",ht,[(o(!0),l(g,null,b(d.value.totalPages,t=>(o(),l("button",{key:t,onClick:n=>{d.value.page=t,_()},class:X(["px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",t===d.value.page?"bg-bpjs-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"])},r(t),11,kt))),128))])])):Q("",!0)]))])]),_:1}))}};export{Kt as default};
