import{r as c,B as H,z as W,h as o,e as G,w as X,c as s,j as x,b as e,t as f,q as I,T as ee,C as te,k as oe,l as D,o as se,m as le,a as F,d as re,F as L,i as g,n as ae,g as O,u as ne,y as $}from"./index-Cv3Gfbck.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"relative w-full max-w-6xl h-[95vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col"},de={class:"flex items-center justify-between px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white"},ue={class:"flex items-center"},ce={class:"text-lg font-bold"},ve={class:"flex-1 bg-gray-200 relative"},me={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-700 z-10"},fe={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-700 z-10"},pe={class:"text-center text-white"},he={class:"text-gray-400 text-sm"},ge=["src"],xe={__name:"PdfViewerModal",props:{show:{type:Boolean,default:!1},pdfUrl:{type:String,default:""},title:{type:String,default:"PDF Viewer"}},emits:["close"],setup(j,{emit:T}){const b=j,y=T,d=c(!0),p=c(!1),_=c(""),a=c(null);async function i(){if(b.pdfUrl){d.value=!0,p.value=!1,_.value="",a.value&&(URL.revokeObjectURL(a.value),a.value=null);try{let n=b.pdfUrl;n.includes("/")&&(n=n.split("/").pop()),console.log("Loading PDF:",n);const r=await fetch("/api/upload/pdf/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:n})});if(!r.ok)throw new Error(`HTTP ${r.status}: Gagal mengambil PDF`);const k=await r.json();if(!k.success||!k.data)throw new Error("Data PDF tidak valid");const u=atob(k.data),C=new Uint8Array(u.length);for(let M=0;M<u.length;M++)C[M]=u.charCodeAt(M);const B=new Blob([C],{type:"application/pdf"});a.value=URL.createObjectURL(B),console.log("PDF loaded, blob URL created"),d.value=!1}catch(n){console.error("Error loading PDF:",n),p.value=!0,_.value=n.message||"Gagal memuat PDF",d.value=!1}}}function w(){y("close"),a.value&&(URL.revokeObjectURL(a.value),a.value=null)}return H(()=>b.show,n=>{n?i():a.value&&(URL.revokeObjectURL(a.value),a.value=null)}),H(()=>b.show,n=>{document.body.style.overflow=n?"hidden":""}),(n,r)=>(o(),W(te,{to:"body"},[G(ee,{name:"modal"},{default:X(()=>[j.show?(o(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:I(w,["self"])},[r[6]||(r[6]=e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm"},null,-1)),e("div",ie,[e("div",de,[e("div",ue,[r[0]||(r[0]=e("svg",{class:"w-6 h-6 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("h3",ce,f(j.title),1)]),e("button",{onClick:w,class:"p-2 hover:bg-white/20 rounded-lg transition-colors",title:"Tutup"},[...r[1]||(r[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ve,[d.value?(o(),s("div",me,[...r[2]||(r[2]=[e("div",{class:"text-center text-white"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),e("p",null,"Memuat PDF...")],-1)])])):p.value?(o(),s("div",fe,[e("div",pe,[r[3]||(r[3]=e("svg",{class:"w-16 h-16 mx-auto mb-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r[4]||(r[4]=e("p",{class:"text-lg font-medium mb-2"},"Gagal memuat PDF",-1)),e("p",he,f(_.value),1)])])):a.value?(o(),s("iframe",{key:2,src:a.value+"#toolbar=0&navpanes=0",class:"w-full h-full border-0",title:"PDF Viewer"},null,8,ge)):x("",!0)]),e("div",{class:"px-6 py-3 bg-gray-100 border-t border-gray-200 flex items-center justify-between"},[r[5]||(r[5]=e("div",{class:"flex items-center text-sm text-gray-500"},[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",null,"Gunakan scroll atau zoom di viewer untuk navigasi")],-1)),e("button",{onClick:w,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"}," Tutup ")])])])):x("",!0)]),_:1})]))}},we=N(xe,[["__scopeId","data-v-706a9742"]]),be={class:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100"},ye={key:0,class:"flex justify-center items-center min-h-screen"},ke={key:1,class:"flex flex-col justify-center items-center min-h-screen p-4"},_e={class:"bg-white rounded-2xl shadow-xl p-8 max-w-md text-center"},Ce={class:"text-red-500 mb-4"},Me={key:2,class:"flex flex-col justify-center items-center min-h-screen p-4"},je={class:"bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-lg"},Be={class:"max-w-5xl mx-auto px-4 py-6"},Pe={class:"flex items-center justify-between"},ze={class:"text-2xl font-bold"},Fe={class:"text-white/80 text-sm mt-1"},$e={key:0,class:"bg-white/20 rounded-xl px-4 py-2 text-center"},Te={class:"bg-white border-b border-gray-200 sticky top-0 z-10"},Ue={class:"max-w-5xl mx-auto px-4 py-3"},Ve={class:"flex items-center justify-between mb-2"},De={class:"text-sm font-medium text-gray-600"},Le={class:"text-sm text-gray-500"},Se={class:"w-full bg-gray-200 rounded-full h-2"},Re={class:"max-w-5xl mx-auto px-4 py-8"},Ae={key:0,class:"bg-white rounded-2xl shadow-lg overflow-hidden"},He={class:"bg-gradient-to-r from-violet-50 to-purple-50 px-6 py-4 border-b border-violet-100"},Oe={class:"text-xl font-bold text-gray-800"},Ge={key:0,class:"aspect-video bg-black"},Ie=["src"],Ne={key:1,class:"aspect-video bg-black"},Ee=["src"],Ke={key:2,class:"p-4 bg-gray-50 border-b"},Qe=["innerHTML"],qe={class:"flex justify-center mt-6 space-x-2"},Je=["onClick"],Ye={class:"flex items-center justify-between mt-8"},Ze=["disabled"],We={key:0},Xe=["disabled"],et={key:0,class:"w-5 h-5 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},tt={key:1,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ot={key:1},st={class:"mt-12"},lt={class:"bg-white rounded-2xl shadow-lg overflow-hidden divide-y divide-gray-100"},rt=["onClick"],at={class:"flex items-center"},nt={class:"flex items-center space-x-3 mt-1"},it={key:0,class:"inline-flex items-center text-xs text-gray-400"},dt={key:1,class:"inline-flex items-center text-xs text-gray-400"},ut={key:0,class:"w-5 h-5 text-violet-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ct={__name:"MateriPeriodePage",setup(j){const T=le(),b=ne();oe();const y=c(null),d=c([]),p=c({isCompleted:!1}),_=c(!0),a=c(null),i=c(0),w=c(!1),n=c(!1),r=c(""),k=c(""),u=D(()=>d.value[i.value]||null),C=D(()=>i.value===d.value.length-1),B=D(()=>i.value===0);se(async()=>{await M()});async function M(){var l,t;try{const v=T.params.periodeId,[P,z,h]=await Promise.all([F.get(`/periode/user/${v}`),F.get(`/periode/user/${v}/materi`),F.get(`/periode/user/${v}/materi-progress`).catch(()=>({data:{isCompleted:!1}}))]);y.value=P.data,d.value=z.data.sort((m,V)=>m.urutan-V.urutan),p.value=h.data}catch(v){((l=v.response)==null?void 0:l.status)===403?a.value="Anda tidak memiliki akses ke periode ini":((t=v.response)==null?void 0:t.status)===404?a.value="Periode tidak ditemukan":a.value="Gagal memuat materi",console.error(v)}finally{_.value=!1}}function E(){C.value||(i.value++,window.scrollTo({top:0,behavior:"smooth"}))}function K(){B.value||(i.value--,window.scrollTo({top:0,behavior:"smooth"}))}function S(l){i.value=l,window.scrollTo({top:0,behavior:"smooth"})}async function Q(){w.value=!0;try{await F.post(`/periode/user/${y.value.id}/materi-progress/complete`),p.value.isCompleted=!0,p.value.completedAt=new Date().toISOString()}catch(l){console.error(l),alert("Gagal menandai materi sebagai selesai")}finally{w.value=!1}}function q(){b.push(`/periode/${y.value.id}/test`)}function U(){b.back()}function J(l){if(!l)return null;const t=l.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]+)/);if(t)return`https://www.youtube.com/embed/${t[1]}`;const v=l.match(/vimeo\.com\/(\d+)/);return v?`https://player.vimeo.com/video/${v[1]}`:l}function R(l){return l.videoType==="url"&&l.videoUrl?J(l.videoUrl):l.videoType==="upload"&&l.videoFile?l.videoFile:null}function A(l){return l.videoType==="upload"&&l.videoFile}function Y(l){r.value=l.pdfFile,k.value=l.judul,n.value=!0}function Z(){n.value=!1,r.value="",k.value=""}return(l,t)=>{var v,P,z;return o(),s("div",be,[_.value?(o(),s("div",ye,[...t[1]||(t[1]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-violet-500 mx-auto mb-4"}),e("p",{class:"text-gray-500"},"Memuat materi...")],-1)])])):a.value?(o(),s("div",ke,[e("div",_e,[t[2]||(t[2]=e("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("p",Ce,f(a.value),1),e("button",{onClick:U,class:"btn-primary"},"Kembali")])])):d.value.length===0?(o(),s("div",Me,[e("div",{class:"bg-white rounded-2xl shadow-xl p-8 max-w-md text-center"},[t[3]||(t[3]=re('<div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4" data-v-829ffb97><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-829ffb97><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" data-v-829ffb97></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-2" data-v-829ffb97>Belum Ada Materi</h3><p class="text-gray-500 mb-4" data-v-829ffb97>Materi untuk periode ini belum tersedia</p>',3)),e("button",{onClick:U,class:"btn-primary"},"Kembali")])])):(o(),s(L,{key:3},[e("header",je,[e("div",Be,[e("div",Pe,[e("div",null,[e("button",{onClick:U,class:"flex items-center text-white/80 hover:text-white mb-2 transition-colors"},[...t[4]||(t[4]=[e("svg",{class:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),g(" Kembali ",-1)])]),e("h1",ze,"Materi "+f((v=y.value)==null?void 0:v.nama),1),e("p",Fe,f((z=(P=y.value)==null?void 0:P.subKategori)==null?void 0:z.nama),1)]),p.value.isCompleted?(o(),s("div",$e,[...t[5]||(t[5]=[e("div",{class:"flex items-center text-emerald-200"},[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),g(" Selesai ")],-1)])])):x("",!0)])])]),e("div",Te,[e("div",Ue,[e("div",Ve,[e("span",De," Materi "+f(i.value+1)+" dari "+f(d.value.length),1),e("span",Le,f(Math.round((i.value+1)/d.value.length*100))+"% ",1)]),e("div",Se,[e("div",{class:"bg-gradient-to-r from-violet-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:ae({width:`${(i.value+1)/d.value.length*100}%`})},null,4)])])]),e("main",Re,[u.value?(o(),s("div",Ae,[e("div",He,[e("h2",Oe,f(u.value.judul),1)]),R(u.value)&&!A(u.value)?(o(),s("div",Ge,[e("iframe",{src:R(u.value),class:"w-full h-full",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,Ie)])):A(u.value)?(o(),s("div",Ne,[e("video",{src:u.value.videoFile,class:"w-full h-full",controls:"",controlsList:"nodownload",oncontextmenu:"return false;"}," Browser Anda tidak mendukung video player. ",8,Ee)])):x("",!0),u.value.pdfFile?(o(),s("div",Ke,[e("button",{type:"button",onClick:t[0]||(t[0]=I(h=>Y(u.value),["prevent","stop"])),class:"inline-flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"},[...t[6]||(t[6]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),g(" Baca PDF ",-1)])])])):x("",!0),e("div",{class:"p-6 prose prose-lg max-w-none",innerHTML:u.value.konten},null,8,Qe)])):x("",!0),e("div",qe,[(o(!0),s(L,null,O(d.value,(h,m)=>(o(),s("button",{key:h.id,onClick:V=>S(m),class:$(["w-3 h-3 rounded-full transition-all",m===i.value?"bg-violet-500 scale-125":"bg-gray-300 hover:bg-gray-400"])},null,10,Je))),128))]),e("div",Ye,[e("button",{onClick:K,disabled:B.value,class:"flex items-center px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200 transition-colors"},[...t[7]||(t[7]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),g(" Sebelumnya ",-1)])],8,Ze),C.value&&!p.value.isCompleted?(o(),s("div",We,[e("button",{onClick:Q,disabled:w.value,class:"flex items-center px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-medium shadow-lg shadow-emerald-500/30 hover:shadow-xl disabled:opacity-50 transition-all"},[w.value?(o(),s("svg",et,[...t[8]||(t[8]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),s("svg",tt,[...t[9]||(t[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])),t[10]||(t[10]=g(" Selesai Baca Materi ",-1))],8,Xe)])):C.value&&p.value.isCompleted?(o(),s("div",ot,[e("button",{onClick:q,class:"flex items-center px-8 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-medium shadow-lg shadow-blue-500/30 hover:shadow-xl transition-all"},[...t[11]||(t[11]=[g(" Lanjut ke Quiz ",-1),e("svg",{class:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])])):(o(),s("button",{key:2,onClick:E,class:"flex items-center px-6 py-3 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-medium shadow-lg shadow-violet-500/30 hover:shadow-xl transition-all"},[...t[12]||(t[12]=[g(" Selanjutnya ",-1),e("svg",{class:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]))]),e("div",st,[t[16]||(t[16]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Daftar Materi",-1)),e("div",lt,[(o(!0),s(L,null,O(d.value,(h,m)=>(o(),s("button",{key:h.id,onClick:V=>S(m),class:$(["w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors text-left",m===i.value?"bg-violet-50":""])},[e("div",at,[e("span",{class:$(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-4",m===i.value?"bg-violet-500 text-white":"bg-gray-100 text-gray-600"])},f(m+1),3),e("div",null,[e("span",{class:$(["font-medium",m===i.value?"text-violet-600":"text-gray-700"])},f(h.judul),3),e("div",nt,[h.videoUrl||h.videoFile?(o(),s("span",it,[...t[13]||(t[13]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),g(" Video ",-1)])])):x("",!0),h.pdfFile?(o(),s("span",dt,[...t[14]||(t[14]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),g(" PDF ",-1)])])):x("",!0)])])]),m===i.value?(o(),s("svg",ut,[...t[15]||(t[15]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])])):x("",!0)],10,rt))),128))])])])],64)),G(we,{show:n.value,"pdf-url":r.value,title:k.value,onClose:Z},null,8,["show","pdf-url","title"])])}}},ft=N(ct,[["__scopeId","data-v-829ffb97"]]);export{ft as default};
